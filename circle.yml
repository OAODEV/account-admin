machine:
  environment:
    service_name: account-admin
    CLOUDSDK_CORE_DISABLE_PROMPTS: 1
    CLOUDSDK_PYTHON_SITEPACKAGES: 1
    CLOUDSDK_COMPUTE_ZONE: us-central1-b
    PATH: $PATH:/home/ubuntu/google-cloud-sdk/bin

dependencies:
  override:
    - sudo /opt/google-cloud-sdk/bin/gcloud --quiet components update

test:
  override:
    - true
deployment:
  index:
    branch: /.*/
    commands:
      - echo $gcloud_key | base64 --decode > gcloud.json; gcloud auth activate-service-account $gcloud_email --key-file gcloud.json; ssh-keygen -f ~/.ssh/google_compute_engine -N ""
      - gcloud -q app deploy app.yaml 
